<br /><br />
<div id="view-content">
	<?php
	
	if (isset($this->error)):
		print $this->error;
	else:
	?>
	Schedule for <?php print date('l, F j, Y', $this->timestamp) ?>
	<table class="schedule">
		<thead>
			<tr>
				<td>Time</td>
				<td>Location</td>
				<td>Consultant</td>
			</tr>
		</thead>
		<tbody>
			<?php foreach ($this->schedule as $shift): ?>
			<?php if ($shift instanceof Application_Model_TempShift) { $temp = $shift; $shift = $temp->getShift(); } ?>
			
			<tr>
				<td><?php print $shift->getTimeString() ?></td>
				<td><?php print $shift->getLocation() ?></td>
				<td><?php
				// Is there a temp shift?
				if (isset($temp))
				{
					// Has someone taken the shift?
					if ($temp->getTempConsultant())
					{
						if ($temp->getTempConsultant()->getId() == $this->user->getId())
						{
							print 'You are covering this shift (<a href="' . $this->url(array(
									'controller' => 'temp',
									'action'     => 'cancel',
									'id'         => $temp->getId(),
								), null, true) . '">cancel</a>)'; 
						}
						else
						{
							print $temp->getTempConsultant()->getName() . ' is covering this shift';
						}
					}
					else
					{
						if ($shift->getConsultant()->getId() == $this->user->getId())
						{
							print '<a href="' . $this->url(array(
									'controller' => 'temp',
									'action' => 'cancel',
									'id' => $temp->getId(),
									), null, true) . '">Cancel this temp shift</a>';
						}
						else
						{
							// Allow someone to claim the shift
							print '<a href="' . $this->url(array(
									'controller' => 'temp',
									'action'     => 'take',
									'id' => $temp->getId(),
								), null, true) . '">Take this shift</a>';
						}
					}
				}
				// No temp shift
				else
				{
					// Is the shift assigned?
					if ($shift->getConsultant() !== null)
					{
						// No temp, assigned
						print $shift->getConsultant()->getName();
						
						if ($shift->getConsultant()->getId() == $this->user->getId())
						{
							$links = array();
							
							// Add a link to temp the shift
							$links[] = '<a href="' . $this->url(array(
									'controller' => 'temp',
									'action' => 'create',
									'id' => $shift->getId(),
							), null, true) . '">request temp</a>';
							
							list($start, $m, $s) = explode(':', $shift->getStartTime());
							list($end, $m, $s) = explode(':', $shift->getEndTime());
							
							// If not a single hour temp
							// Absolute value to handle 2300-0200 shifts
							if (abs($end - $start) > 1)
							{
								// Add a link to temp the shift
								$links[] = ' <a href="' . $this->url(array(
										'controller' => 'temp',
										'action' => 'create',
										'id' => $shift->getId(),
										'form' => true,
								), null, true) . '">temp part</a>';
							}
							
							print ' (' . implode(', ', $links) . ')';
						}
					}
					else
					{
						// No temp, no consultant
						print 'No consultant assigned';
					}
				}
				?></td>
			</tr>
			<?php unset($temp) ?>
			<?php endforeach ?>
		</tbody>
	</table>
	<?php endif ?>
</div>